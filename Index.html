<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Água Já Itupeva - Pensou, chegou</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css">
</head>
<body class="bg-blue-100 font-sans">
    <header class="bg-blue-600 text-white text-center p-4">
        <div class="flex items-center justify-center">
            <img src="https://toptotal.com.br/media/com_jbusinessdirectory/pictures/categories/disk_agua-1592488087.png" alt="Logo Água Já Itupeva" class="h-20 mr-3">
            <h1 class="text-2xl font-bold">Água Já Itupeva</h1>
        </div>
        <p id="boasVindas" class="text-sm"></p>
    </header>

    <main class="p-6 flex justify-center">
        <div class="w-full max-w-4xl bg-white p-6 rounded-lg shadow-lg">
            <!-- Login do Cliente -->
            <div id="loginSection">
                <h2 class="text-xl font-semibold text-center mb-4">Login do Cliente</h2>
                <form id="loginForm" class="mb-6">
                    <label for="telefoneLogin" class="block text-sm font-medium text-gray-700">Telefone:</label>
                    <input type="tel" id="telefoneLogin" name="telefoneLogin" class="mt-1 p-2 w-full border rounded" required>
                    <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded mt-4">Entrar</button>
                </form>
                <p class="text-center mt-2">
                    <a href="#" onclick="esqueceuSenha()" class="text-blue-500 underline">Esqueceu a senha?</a>
                </p>
            </div>

            <!-- Cadastro do Cliente -->
            <div id="cadastroSection" class="hidden">
                <h2 class="text-xl font-semibold text-center mb-4">Cadastro do Cliente</h2>
                <form id="cadastroForm" class="mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="nome" class="block text-sm font-medium text-gray-700">Nome:</label>
                            <input type="text" id="nome" name="nome" class="mt-1 p-2 w-full border rounded" required>
                        </div>
                        <div>
                            <label for="telefone" class="block text-sm font-medium text-gray-700">Telefone:</label>
                            <input type="tel" id="telefone" name="telefone" class="mt-1 p-2 w-full border rounded" required>
                        </div>
                        <div>
                            <label for="email" class="block text-sm font-medium text-gray-700">E-mail:</label>
                            <input type="email" id="email" name="email" class="mt-1 p-2 w-full border rounded" required>
                        </div>
                    </div>
                    <div class="mt-4">
                        <label for="endereco" class="block text-sm font-medium text-gray-700">Endereço:</label>
                        <input type="text" id="endereco" name="endereco" class="mt-1 p-2 w-full border rounded" required>
                    </div>
                    <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded mt-4">Salvar Cadastro</button>
                </form>
            </div>

            <!-- Página de Compras -->
            <div id="compraSection" class="hidden">
                <h2 class="text-xl font-semibold text-center mb-4">Escolha seus galões</h2>

                <div class="mt-4">
                    <h4 class="font-semibold">Entrega ou Retirada?</h4>
                    <div class="mt-2">
                        <label><input type="radio" name="retirada" value="entrega" checked onchange="atualizarDesconto()"> Entrega</label><br>
                        <label><input type="radio" name="retirada" value="retirada" onchange="atualizarDesconto()"> Retirada (Desconto de 15%)</label>
                    </div>
                </div>

                <div class="overflow-x-auto mt-4">
                    <table class="table-auto w-full bg-white rounded-lg shadow">
                        <thead>
                            <tr>
                                <th class="px-4 py-2">Produto</th>
                                <th class="px-4 py-2">Preço Unitário</th>
                                <th class="px-4 py-2">Quantidade</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="px-4 py-2">Galão Ibirá - 20L</td>
                                <td class="px-4 py-2">R$ 15,00</td>
                                <td class="px-4 py-2"><input type="number" id="ibiraQty" value="0" min="0" class="w-16 border rounded" onchange="atualizarDesconto()"></td>
                            </tr>
                            <tr>
                                <td class="px-4 py-2">Galão Água Minagem - 20L</td>
                                <td class="px-4 py-2">R$ 18,00</td>
                                <td class="px-4 py-2"><input type="number" id="minagemQty" value="0" min="0" class="w-16 border rounded" onchange="atualizarDesconto()"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="mt-6 text-center">
                    <button onclick="fecharPedido()" class="bg-blue-500 text-white px-6 py-2 rounded">Fechar Pedido</button>
                </div>

                <!-- Resumo do Pedido -->
                <div id="resumoPedido" class="mt-6 hidden bg-white p-4 rounded-lg shadow">
                    <h3 class="text-lg font-bold mb-2">Resumo do Pedido</h3>
                    <p id="resumoTexto" class="text-gray-700"></p>
                    <h4 class="font-semibold mt-2">Forma de Pagamento</h4>
                    <div class="mt-2">
                        <label><input type="radio" name="pagamento" value="pix"> Pix (CNPJ: 41823685000153)</label><br>
                        <a href="https://wa.me/5517991255999?text=Envie%20o%20comprovante%20de%20pagamento%20para%20este%20n%C3%BAmero." target="_blank" class="text-blue-500 underline">Enviar comprovante pelo WhatsApp</a><br>
                        <label><input type="radio" name="pagamento" value="dinheiro"> Dinheiro</label><br>
                        <label><input type="radio" name="pagamento" value="cartao"> Cartão na entrega</label>
                    </div>

                    <button onclick="finalizarPedido()" class="bg-green-500 text-white px-4 py-2 rounded mt-4">Finalizar Pedido</button>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-blue-600 text-white text-center p-4 mt-6">
        <p>&copy; 2025 Água Já Itupeva. Todos os direitos reservados.</p>
    </footer>

    <script>
        let clientes = JSON.parse(localStorage.getItem('clientes')) || {};
        let clienteAtual = null;

        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const telefone = document.getElementById('telefoneLogin').value;
            if (clientes[telefone]) {
                clienteAtual = clientes[telefone];
                mostrarBoasVindas(clienteAtual.nome);
                mostrarCompra();
            } else {
                alert('Cliente não cadastrado. Faça o cadastro.');
                document.getElementById('loginSection').classList.add('hidden');
                document.getElementById('cadastroSection').classList.remove('hidden');
                document.getElementById('telefone').value = telefone;
            }
        });

        document.getElementById('cadastroForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const nome = document.getElementById('nome').value;
            const telefone = document.getElementById('telefone').value;
            const email = document.getElementById('email').value;
            const endereco = document.getElementById('endereco').value;

            clientes[telefone] = { nome, telefone, email, endereco, compras: 0 };
            localStorage.setItem('clientes', JSON.stringify(clientes));
            clienteAtual = clientes[telefone];

            mostrarBoasVindas(nome);
            mostrarCompra();
        });

        function esqueceuSenha() {
            const telefone = prompt('Digite seu telefone cadastrado:');
            if (clientes[telefone]) {
                const email = clientes[telefone].email;
                const novaSenha = Math.random().toString(36).slice(-8);
                alert(`Uma nova senha foi enviada para o e-mail cadastrado: ${email}\nSua nova senha é: ${novaSenha}`);
            } else {
                alert('Telefone não cadastrado.');
            }
        }

        function mostrarBoasVindas(nome) {
            document.getElementById('boasVindas').innerText = `Bem-vindo, ${nome}!`;
        }

        function mostrarCompra() {
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('cadastroSection').classList.add('hidden');
            document.getElementById('compraSection').classList.remove('hidden');
        }

        function atualizarDesconto() {
            const retirada = document.querySelector('input[name="retirada"]:checked').value;
            const ibiraQty = parseInt(document.getElementById('ibiraQty').value) || 0;
            const minagemQty = parseInt(document.getElementById('minagemQty').value) || 0;

            let total = (ibiraQty * 15) + (minagemQty * 18);

            if (retirada === 'retirada') {
                total *= 0.85;
            }

            document.getElementById('resumoTexto').innerText = `Galão Ibirá: ${ibiraQty} x R$ 15,00 = R$ ${(ibiraQty * 15).toFixed(2)}\nGalão Minagem: ${minagemQty} x R$ 18,00 = R$ ${(minagemQty * 18).toFixed(2)}\nTotal: R$ ${total.toFixed(2)}`;
        }

        function fecharPedido() {
            const ibiraQty = parseInt(document.getElementById('ibiraQty').value) || 0;
            const minagemQty = parseInt(document.getElementById('minagemQty').value) || 0;

            if (!clienteAtual) {
                alert('Por favor, faça login ou cadastro antes de fechar o pedido.');
                return;
            }

            clienteAtual.compras += ibiraQty + minagemQty;
            if (clienteAtual.compras >= 10) {
                alert('Parabéns! Você ganhou 1 galão grátis!');
                clienteAtual.compras -= 10;
            }

            localStorage.setItem('clientes', JSON.stringify(clientes));
            document.getElementById('resumoPedido').classList.remove('hidden');
            atualizarDesconto();
        }

        function finalizarPedido() {
            const ibiraQty = parseInt(document.getElementById('ibiraQty').value) || 0;
            const minagemQty = parseInt(document.getElementById('minagemQty').value) || 0;
            const retirada = document.querySelector('input[name="retirada"]:checked').value;
            const total = document.getElementById('resumoTexto').innerText;

            const mensagem = `Pedido de ${clienteAtual.nome} - Telefone: ${clienteAtual.telefone}\nEndereço: ${clienteAtual.endereco}\n\n${total}\nForma de Retirada: ${retirada}\nPagamento: ${document.querySelector('input[name="pagamento"]:checked').value}`;

            const url = `https://wa.me/5517991255999?text=${encodeURIComponent(mensagem)}`;
            window.open(url, '_blank');

            alert('Pedido finalizado e enviado para o WhatsApp!');
        }
    </script>
</body>
</html>
